<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./QRCodeGenerator/qrcode.min.js"></script>
</head>

<body>
    <h1>QR Code</h1>
    <input type="text" id="textQR" placeholder="QR Code Text">
    <input type="color" id="fillColor">
    <input type="color" id="boxColor">
    <input type="range" id="sizeQR" min="100" max="3000" step="100" value="300">

    <div id="QRCodeContainer"></div>
    <a href="" id="linkDownloadButton" download>
        <button id="downloadButton">Download</button>
    </a>

    <script>
        const textQR = document.querySelector("#textQR");
        const fillColor = document.querySelector("#fillColor");
        const boxColor = document.querySelector("#boxColor");
        const sizeQR = document.querySelector("#sizeQR");
        const QRCodeContainer = document.querySelector("#QRCodeContainer");
        const downloadButton = document.querySelector("#downloadButton");
        const linkDownloadButton = document.querySelector("#linkDownloadButton");
        const canvas = document.getElementById('canvas');

        const defaultUrl = "https://adhityabaguswicaksono.github.io/";
        let colorLight = "#fff",
            colorDark = "#000",
            text = defaultUrl,
            size = 300;

        textQR.addEventListener("input", function (e) {
            text = e.target.value;
            if (text.length == 0) {
                text = defaultUrl;
            }
            generateQRCode();
            downloadQRCode();
        });

        fillColor.addEventListener("input", function (e) {
            colorLight = e.target.value;
            generateQRCode();
            downloadQRCode();
        });

        boxColor.addEventListener("input", function (e) {
            colorDark = e.target.value;
            generateQRCode();
            downloadQRCode();
        });

        sizeQR.addEventListener("input", function (e) {
            size = e.target.value;
            generateQRCode();
            downloadQRCode();
        })

        window.onload = function (e) {
            downloadQRCode();
        }

        window.onchange = function (e) {
            downloadQRCode();
        }

        function generateQRCode() {
            QRCodeContainer.innerHTML = "";
            new QRCode(QRCodeContainer, {
                text,
                height: size,
                width: size,
                colorLight,
                colorDark,
                correctLevel: QRCode.CorrectLevel.L
            });

            downloadQRCode();
        }

        function downloadQRCode() {
            const image = QRCodeContainer.children[1].src;

            linkDownloadButton.setAttribute("href", image);
            linkDownloadButton.setAttribute("download", "Pembuat Kode QR - Adhitya Bagus Wicaksono.png");
            linkDownloadButton.appendChild(downloadButton);
        }

        generateQRCode();
        downloadQRCode();
    </script>

</body>

</html>